local h=cloneref(game:GetService("HttpService"));local _={}do _.Folder="LinoriaLibSettings"_.Ignore={}_.Parser={Toggle={Save=function(i,o)return{type="Toggle",idx=i,value=o.Value}end,Load=function(i,d)if Toggles[i]then Toggles[i]:SetValue(d.value)end end},Slider={Save=function(i,o)return{type="Slider",idx=i,value=tostring(o.Value)}end,Load=function(i,d)if Options[i]then Options[i]:SetValue(d.value)end end},Dropdown={Save=function(i,o)return{type="Dropdown",idx=i,value=o.Value,multi=o.Multi}end,Load=function(i,d)if Options[i]then Options[i]:SetValue(d.value)end end},ColorPicker={Save=function(i,o)return{type="ColorPicker",idx=i,value=o.Value:ToHex(),transparency=o.Transparency}end,Load=function(i,d)if Options[i]then Options[i]:SetValueRGB(Color3.fromHex(d.value),d.transparency)end end},KeyPicker={Save=function(i,o)return{type="KeyPicker",idx=i,mode=o.Mode,key=o.Value}end,Load=function(i,d)if Options[i]then Options[i]:SetValue({d.key,d.mode})end end},Input={Save=function(i,o)return{type="Input",idx=i,text=o.Value}end,Load=function(i,d)if Options[i]and type(d.text)=="string"then Options[i]:SetValue(d.text)end end}}local function I(t)return _.Ignore[t]end function _:SetIgnoreIndexes(l)for _,k in next,l do self.Ignore[k]=true end end function _:SetFolder(f)self.Folder=f;self:BuildFolderTree()end function _:Save(n)if(not n)then return false,"no config file is selected"end local p=self.Folder.."/settings/"..n..".json"local d={objects={}}for i,t in next,Toggles do if I(i)then continue end table.insert(d.objects,self.Parser[t.Type].Save(i,t))end for i,o in next,Options do if not self.Parser[o.Type]then continue end if I(i)then continue end table.insert(d.objects,self.Parser[o.Type].Save(i,o))end local s,e=pcall(h.JSONEncode,h,d)if not s then return false,"failed to encode data"end writefile(p,e)return true end function _:Load(n)if(not n)then return false,"no config file is selected"end local f=self.Folder.."/settings/"..n..".json"if not isfile(f)then return false,"invalid file"end local s,d=pcall(h.JSONDecode,h,readfile(f))if not s then return false,"decode error"end for _,o in next,d.objects do if self.Parser[o.type]then task.spawn(function()self.Parser[o.type].Load(o.idx,o)end)end end if self.OnConfigLoaded then task.defer(self.OnConfigLoaded,d)end return true end function _:IgnoreThemeSettings()self:SetIgnoreIndexes({"BackgroundColor","MainColor","AccentColor","OutlineColor","FontColor","ThemeManager_ThemeList","ThemeManager_CustomThemeList","ThemeManager_CustomThemeName"})end function _:BuildFolderTree()local p={self.Folder,self.Folder.."/themes",self.Folder.."/settings"}for i=1,#p do local s=p[i]if not isfolder(s)then makefolder(s)end end end function _:RefreshConfigList()local l=listfiles(self.Folder.."/settings")local o={}for i=1,#l do local f=l[i]if f:sub(-5)==".json"then local p=f:find(".json",1,true)local a=p local c=f:sub(p,p)while c~="/"and c~="\\"and c~=""do p=p-1 c=f:sub(p,p)end if c=="/"or c=="\\"then table.insert(o,f:sub(p+1,a-1))end end end return o end function _:SetLibrary(l)self.Library=l end function _:LoadAutoloadConfig()if isfile(self.Folder.."/settings/autoload.txt")then local n=readfile(self.Folder.."/settings/autoload.txt")local s,e=self:Load(n)if not s then return self.Library:Notify("Failed to load autoload config: "..e)end self.Library:Notify(string.format("Auto loaded config %q",n))end end function _:BuildConfigSection(t)assert(self.Library,"Must set SaveManager.Library")local s=t:AddRightGroupbox("Configuration")s:AddInput("SaveManager_ConfigName",{Text="Config name"})s:AddDropdown("SaveManager_ConfigList",{Text="Config list",Values=self:RefreshConfigList(),AllowNull=true})s:AddDivider()s:AddButton("Create config",function()local n=Options.SaveManager_ConfigName.Value if n:gsub(" ","")==""then return self.Library:Notify("Invalid config name (empty)",2)end local sc,e=self:Save(n)if not sc then return self.Library:Notify("Failed to save config: "..e)end self.Library:Notify(string.format("Created config %q",n))Options.SaveManager_ConfigList:SetValues(self:RefreshConfigList())Options.SaveManager_ConfigList:SetValue(nil)end):AddButton("Load config",function()local n=Options.SaveManager_ConfigList.Value local sc,e=self:Load(n)if not sc then return self.Library:Notify("Failed to load config: "..e)end self.Library:Notify(string.format("Loaded config %q",n))end)s:AddButton("Overwrite config",function()local n=Options.SaveManager_ConfigList.Value local sc,e=self:Save(n)if not sc then return self.Library:Notify("Failed to overwrite config: "..e)end self.Library:Notify(string.format("Overwrote config %q",n))end)s:AddButton("Refresh list",function()Options.SaveManager_ConfigList:SetValues(self:RefreshConfigList())Options.SaveManager_ConfigList:SetValue(nil)end)s:AddButton("Set as autoload",function()local n=Options.SaveManager_ConfigList.Value writefile(self.Folder.."/settings/autoload.txt",n)_.AutoloadLabel:SetText("Current autoload config: "..n)self.Library:Notify(string.format("Set %q to auto load",n))end)_.AutoloadLabel=s:AddLabel("Current autoload config: none",true)if isfile(self.Folder.."/settings/autoload.txt")then local n=readfile(self.Folder.."/settings/autoload.txt")_.AutoloadLabel:SetText("Current autoload config: "..n)end self:SetIgnoreIndexes({"SaveManager_ConfigList","SaveManager_ConfigName"})end _:BuildFolderTree()end return _
